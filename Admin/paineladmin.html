<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D'Italia Pizzaria - Admin</title>
  <link rel="manifest" href="manifest-admin.json">
  <link rel="stylesheet" href="styleadmin.css">
  <link rel="stylesheet" href="styleadmin-2.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
  <script>
    eruda.init();
  </script>
</head>

<body>
  <div class="admin-app-container">
    <header class="admin-top-bar">
      <div class="logo-container">
        <img src="../img/logos/logo.png" alt="Logo D'Italia" class="admin-logo-sm">
        <span class="admin-title">D'Italia Pizzaria</span>
      </div>
      <button id="open-drawer-menu" class="menu-drawer-button">
        <i class="fas fa-bars"></i>
        <span>Menu</span>
      </button>
    </header>

    <nav id="admin-drawer-menu" class="admin-drawer">
      <div class="drawer-header">
        <h3>Menu Principal</h3>
        <button id="close-drawer-menu" class="close-drawer-btn">&times;</button>
      </div>
      <ul>
        <li><a href="#" data-section-target="appearance-view"><i class="fas fa-paint-brush"></i> Aparência do Site</a></li>
        <li><a href="#" data-section-target="cardapio-view"><i class="fas fa-utensils"></i> Gerenciar Cardápio</a></li>
        <li><a href="#" data-section-target="pdv-content"><i class="fas fa-cash-register"></i> PDV (Ponto de Venda)</a></li>
        <li class="active-link"><a href="#" data-section-target="orders-content"><i class="fas fa-receipt"></i> Pedidos</a></li>
        <li><a href="#" data-section-target="vendas-view"><i class="fas fa-chart-line"></i> Relatório de Vendas</a></li>
        <li><a href="#" data-section-target="customers-content"><i class="fas fa-users"></i> Clientes</a></li>
        <li><a href="#" data-section-target="promotions-content"><i class="fas fa-tags"></i> Promoções</a></li>
        <li><a href="#" data-section-target="settings-content"><i class="fas fa-cog"></i> Configurações</a></li>
        <li>
          <hr>
        </li>
        <li><a href="../index.html" target="_blank"><i class="fas fa-store"></i> Ver Site Principal</a></li>
        <li><hr></li>
        <li><a href="#" id="logout-button"><i class="fas fa-sign-out-alt"></i> Sair (Logout)</a></li>
      </ul>
    </nav>

    <div class="drawer-overlay" id="drawer-overlay"></div>

    <main class="admin-main-content">

      <section id="appearance-view" class="admin-view">
        <div class="view-header">
          <h2><i class="fas fa-paint-brush"></i> Aparência do Site</h2>
        </div>
        <p class="form-instruction">
          Altere as imagens e cores do seu site principal. Para as imagens, coloque o arquivo na pasta do projeto (ex: `img/logos/`) e insira o caminho correto no campo de texto.
        </p>

        <form id="appearance-form" class="admin-form">
          <div class="settings-group active">
            <h3><i class="fas fa-image"></i> Imagens Principais</h3>
            <div class="settings-content-wrapper" style="display: block;">
              <div class="form-row">
                <div class="form-group">
                  <label for="logo-path-input">Caminho para o Logo</label>
                  <input type="text" id="logo-path-input" class="form-control" placeholder="Ex: img/logos/logo.png">
                </div>
                <div class="form-group">
                  <label for="banner-path-input">Caminho para o Banner</label>
                  <input type="text" id="banner-path-input" class="form-control" placeholder="Ex: img/banner/banner4.jpg">
                </div>
              </div>
            </div>
          </div>

          <div class="settings-group active" style="margin-top: 2rem;">
            <h3><i class="fas fa-palette"></i> Esquema de Cores</h3>
            <div class="settings-content-wrapper" style="display: block;">
              <div class="form-row">
                <div class="form-group">
                  <label for="primary-color-input">Cor Principal (botões, detalhes)</label>
                  <input type="color" id="primary-color-input" class="form-control-color">
                </div>
                <div class="form-group">
                  <label for="background-color-input">Cor de Fundo Principal</label>
                  <input type="color" id="background-color-input" class="form-control-color">
                </div>
              </div>
            </div>
          </div>

          <div class="form-actions" style="margin-top: 2rem;">
            <button type="submit" class="btn btn-success btn-lg"><i class="fas fa-save"></i> Salvar Alterações de Aparência</button>
          </div>
        </form>
      </section>

      <section id="cardapio-view" class="admin-view">
        <div class="view-header">
          <h2><i class="fas fa-utensils"></i> Gerenciar Cardápio</h2>
          <button id="add-category-button" class="btn btn-primary"><i class="fas fa-plus"></i> Nova Categoria</button>
        </div>
        <div id="category-list-container">
          <p>
            Carregando categorias...
          </p>
        </div>

        <div class="settings-group active" style="margin-top: 2rem; border-top: 2px solid var(--admin-border-color); padding-top: 1rem;">
          <h3 style="padding: 0 1rem; cursor: default;"><i class="fas fa-cheese"></i> Gerenciar Bordas Recheadas</h3>
          <div class="settings-content-wrapper" style="padding: 1rem; display: block;">
            <form id="stuffed-crust-form" class="admin-form" style="padding:var(--space-md); box-shadow: var(--admin-shadow-sm); border: 1px solid var(--admin-border-color); border-radius: var(--admin-border-radius-md); margin-bottom: 2rem;">
              <h4 id="stuffed-crust-form-title">Adicionar Nova Borda</h4>
              <input type="hidden" id="stuffed-crust-id-hidden">
              <div class="form-row">
                <div class="form-group">
                  <label for="stuffed-crust-name">Nome da Borda</label>
                  <input type="text" id="stuffed-crust-name" placeholder="Ex: Catupiry" required>
                </div>
                <div class="form-group">
                  <label for="stuffed-crust-price">Preço Adicional (R$)</label>
                  <input type="number" id="stuffed-crust-price" placeholder="Ex: 10.00" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                  <label for="stuffed-crust-type">Tipo de Borda</label>
                  <select id="stuffed-crust-type" required>
                    <option value="salgada" selected>Salgada</option>
                    <option value="doce">Doce</option>
                  </select>
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Borda</button>
                <button type="button" id="cancel-edit-stuffed-crust-btn" class="btn btn-secondary hidden"><i class="fas fa-times"></i> Cancelar Edição</button>
              </div>
            </form>
            <div id="stuffed-crust-list-container">
              <p>
                Carregando bordas...
              </p>
            </div>
          </div>
        </div>
      </section>

      <section id="pdv-content" class="admin-view">
        <div id="pdv-initial-state">
          <div class="view-header">
            <h2><i class="fas fa-cash-register"></i> PDV - Ponto de Venda</h2>
          </div>
          <p>
            Bem-vindo ao Ponto de Venda!
          </p>
          <button id="start-new-pdv-order" class="btn btn-primary btn-lg"><i class="fas fa-plus-circle"></i> Iniciar Novo Pedido</button>
        </div>
        <div id="pdv-order-creation-view" class="hidden">
          <div class="view-header">
            <h2><i class="fas fa-plus-circle"></i> Novo Pedido no PDV</h2>
            <button id="pdv-cancel-btn" class="btn btn-secondary-outline"><i class="fas fa-times"></i> Cancelar e Voltar</button>
          </div>
          <div class="pdv-layout-container">
            <div class="pdv-order-column">
              <div class="pdv-card">
                <div class="pdv-card-header">
                  <h3 class="pdv-card-title"><i class="fas fa-concierge-bell"></i> Tipo de Pedido</h3>
                </div>
                <div class="pdv-card-body pdv-order-type-selector">
                  <label>
                    <input type="radio" name="pdv-order-type" value="Delivery" checked>
                    <span><i class="fas fa-motorcycle"></i> Delivery</span>
                  </label>
                  <label>
                    <input type="radio" name="pdv-order-type" value="Balcao">
                    <span><i class="fas fa-store-alt"></i> Retirada</span>
                  </label>
                  <label>
                    <input type="radio" name="pdv-order-type" value="Mesa">
                    <span><i class="fas fa-utensils"></i> Mesa</span>
                  </label>
                </div>
              </div>
              <div class="pdv-card">
                <h3 class="pdv-card-title"><i class="fas fa-user-circle"></i> Cliente</h3>
                <div class="pdv-card-body">
                  <div class="form-group">
                    <label class="pdv-card-title">Buscar ou Adicionar Cliente (Nome/WhatsApp)</label>
                    <div class="input-with-icon right-icon">
                      <input type="text" id="pdv-customer-search" class="form-control" placeholder="Digite para buscar...">
                      <button id="pdv-add-new-customer-btn" class="pdv-icon-btn" title="Cadastrar Novo Cliente">
                        <i class="fas fa-user-plus"></i>
                      </button>
                    </div>
                  </div>
                  <div id="pdv-customer-details-container" class="hidden">
                    <hr class="pdv-divider">
                    <h4 class="pdv-details-title">Dados de Entrega</h4>
                    <div id="pdv-customer-address-display" class="pdv-address-display"></div>
                  </div>
                </div>
              </div>
              <div class="pdv-card">
                <div class="pdv-card-header">
                  <h3 class="pdv-card-title"><i class="fas fa-shopping-basket"></i> Itens do Pedido</h3>
                  <button id="pdv-add-product-btn" class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> Adicionar Produtos</button>
                </div>
                <div class="pdv-card-body">
                  <div id="pdv-cart-items" class="pdv-cart-items-list">
                    <p class="empty-cart-text">
                      Adicione produtos ao pedido
                    </p>
                  </div>
                </div>
              </div>
              <div class="pdv-card">
                <h3 class="pdv-card-title"><i class="far fa-comment-alt"></i> Observações</h3>
                <div class="pdv-card-body">
                  <div class="form-group" style="margin-bottom: 0;">
                    <textarea id="pdv-order-notes" rows="3" class="form-control" placeholder="Observações gerais do pedido. Ex: Ligar antes de sair para entregar."></textarea>
                  </div>
                </div>
              </div>
            </div>
            <div class="pdv-summary-column">
              <div class="pdv-card sticky-card">
                <h3 class="pdv-card-title"><i class="fas fa-file-invoice-dollar"></i> Resumo e Pagamento</h3>
                <div class="pdv-card-body">
                  <div class="pdv-totals">
                    <div class="summary-line">
                      <span>Subtotal Produtos (0)</span>
                      <span id="pdv-subtotal">R$ 0,00</span>
                    </div>
                    <div class="summary-line" id="pdv-delivery-fee-line">
                      <span>Entrega</span>
                      <div>
                        <span id="pdv-delivery-fee">R$ 0,00</span>
                        <button class="edit-fee-btn" title="Editar taxa manualmente"><i class="fas fa-pencil-alt"></i></button>
                      </div>
                    </div>
                    <div class="summary-line" id="pdv-discount-line" style="display: none;">
                      <span style="color: var(--admin-success-green);">Desconto Aplicado</span>
                      <span id="pdv-discount-amount" style="color: var(--admin-success-green); font-weight: 500;">- R$ 0,00</span>
                    </div>
                  </div>
                  <div class="form-group">
                    <button class="btn btn-secondary-outline btn-sm" id="pdv-apply-discount-btn" style="width: 100%;"><i class="fas fa-tag"></i> Aplicar Desconto ou Cupom</button>
                  </div>
                  <hr class="pdv-divider">
                  <div id="pdv-payment-section">
                    <div class="form-group">
                      <label for="pdv-payment-method" class="form-label">Forma de Pagamento</label>
                      <select id="pdv-payment-method" class="form-control">
                        <option value="" selected disabled>Selecione...</option>
                        <option value="Dinheiro">Dinheiro</option>
                        <option value="Cartão de Crédito">Cartão de Crédito</option>
                        <option value="Cartão de Débito">Cartão de Débito</option>
                        <option value="Pix">Pix</option>
                      </select>
                    </div>
                    <div id="pdv-change-for-container" class="payment-details-container hidden">
                      <label for="pdv-change-for" class="form-label">Troco para (R$)</label>
                      <input type="number" id="pdv-change-for" class="form-control" placeholder="Ex: 50.00">
                    </div>
                    <div id="pdv-pix-status-container" class="payment-details-container hidden">
                      <label class="form-label">Status do Pagamento Pix</label>
                      <div class="pix-status-options">
                        <label><input type="radio" name="pix-status" value="pago" checked> Pago</label>
                        <label><input type="radio" name="pix-status" value="nao-pago"> Não Pago</label>
                      </div>
                    </div>
                  </div>
                  <hr class="pdv-divider">
                  <div class="form-group" id="pdv-delivery-person-group">
                    <label for="pdv-delivery-person">Atribuir Entregador</label>
                    <div class="input-with-icon right-icon">
                      <select id="pdv-delivery-person" class="form-control">
                        <option value="">Não atribuir (Retirada)</option>
                      </select>
                      <button class="pdv-icon-btn whatsapp" title="Enviar dados do pedido para o WhatsApp do entregador">
                        <i class="fab fa-whatsapp"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="pdv-footer-summary">
                  <div class="pdv-grand-total">
                    <span id="pdv-payment-status" class="pdv-payment-status not-paid">Não pago</span>
                    <div class="total-amount">
                      <span>Total</span>
                      <strong id="pdv-total">R$ 0,00</strong>
                    </div>
                  </div>
                  <div class="pdv-actions-footer">
                    <button id="pdv-accept-btn" class="btn btn-success btn-lg">Confirmar Pedido</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="orders-content" class="admin-view">
        <div class="order-summary-bar">
          <div id="notification-banner" class="notification-banner" style="display: none;">
            <span>Deseja receber notificações de novos pedidos?</span>
            <button id="enable-notifications-btn" class="btn btn-sm btn-success">Ativar</button>
          </div>
          <div class="summary-item" data-type-filter="balcao">
            <i class="fas fa-store-alt"></i>
            <span>Balcão</span>
            <span class="count">0</span>
          </div>
          <div class="summary-item" data-type-filter="delivery">
            <i class="fas fa-motorcycle"></i>
            <span>Delivery</span>
            <span class="count">0</span>
          </div>
          <div class="summary-item" data-type-filter="mesas">
            <i class="fas fa-utensils"></i>
            <span>Mesas</span>
            <span class="count">0</span>
          </div>
          <div class="summary-options">
            <i class="fas fa-ellipsis-v"></i>
          </div>
        </div>
        <div class="order-actions-toolbar">
          <button class="btn btn-primary btn-lg new-order-main-btn">
            <i class="fas fa-plus-circle"></i> Novo pedido
          </button>
        </div>

        <div class="order-status-filters">
          <button class="btn filter-tab active" data-status-filter="todos">Tudo</button>
          <button class="btn filter-tab" data-status-filter="pendente">Pendente <span class="count">0</span></button>
          <button class="btn filter-tab" data-status-filter="em-preparo">Em preparo <span class="count">0</span></button>
          <button class="btn filter-tab" data-status-filter="a-caminho">A caminho <span class="count">0</span></button>
        </div>
        <div id="orders-list-container" class="orders-list-table-wrapper empty">
          <div class="empty-orders-state">
            <i class="fas fa-utensils empty-state-icon"></i>
            <p class="empty-state-message">
              Nenhum pedido ativo.
            </p>
            <button class="btn btn-primary btn-lg empty-state-new-order-btn"><i class="fas fa-plus-circle"></i> Novo pedido</button>
          </div>
        </div>
      </section>

      <section id="vendas-view" class="admin-view">
        <div class="view-header">
          <h2><i class="fas fa-chart-line"></i> Relatório de Vendas</h2>
        </div>

        <div class="admin-form sales-filter-form" style="margin-bottom: var(--space-lg);">
          <div class="form-row">
            <div class="form-group">
              <label for="sales-start-date">Data de Início</label>
              <input type="date" id="sales-start-date" class="form-control">
            </div>
            <div class="form-group">
              <label for="sales-end-date">Data de Fim</label>
              <input type="date" id="sales-end-date" class="form-control">
            </div>
            <div class="form-actions">
              <button id="filter-sales-btn" class="btn btn-primary"><i class="fas fa-filter"></i> Filtrar</button>
            </div>
          </div>
        </div>

        <div class="sales-summary-container-v2">
          <div class="summary-box-v2">
            <div class="icon">
              <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="text">
              <span class="label">Faturamento Total no Período</span>
              <span class="value" id="sales-total-value">R$ 0,00</span>
            </div>
          </div>
          <div class="summary-box-v2">
            <div class="icon">
              <i class="fas fa-receipt"></i>
            </div>
            <div class="text">
              <span class="label">Quantidade de Pedidos</span>
              <span class="value" id="sales-total-count">0</span>
            </div>
          </div>
          <div class="summary-box-v2">
            <div class="icon">
              <i class="fas fa-motorcycle"></i>
            </div>
            <div class="text">
              <span class="label">Total em Taxas de Entrega</span>
              <span class="value" id="sales-total-delivery-fees">R$ 0,00</span>
            </div>
          </div>
        </div>

        <div id="payment-method-summary" class="payment-summary-grid">
        </div>

        <div id="bestsellers-section-container" class="bestsellers-container" style="display: none;">
          <h4><i class="fas fa-star"></i> Top 5 Produtos Mais Vendidos</h4>
          <ul id="bestsellers-list" class="top5-list">
          </ul>
        </div>

        <div id="sales-list-container" style="margin-top: var(--space-lg);">
          <p class="empty-list-message">
            Selecione um período para ver os pedidos.
          </p>
        </div>
      </section>

      <section id="customers-content" class="admin-view">
        <div class="view-header">
          <h2><i class="fas fa-users"></i> Clientes Cadastrados</h2>
        </div>
        <div class="customers-list-controls admin-form" style="margin-bottom:var(--space-lg);padding:var(--space-md);">
          <div class="form-group">
            <label for="search-customer-input">Buscar Cliente (Nome/WhatsApp):</label><input type="text" id="search-customer-input" placeholder="Digite para buscar...">
          </div>
        </div>
        <div id="customers-list-container" class="customers-list-table-wrapper">
          <p class="empty-list-message">
            Nenhum cliente.
          </p>
        </div>
      </section>

      <section id="promotions-content" class="admin-view">
        <div class="view-header">
          <h2><i class="fas fa-tags"></i> Gerenciar Promoções</h2><button id="toggle-new-promotion-form-btn" class="btn btn-primary"><i class="fas fa-plus"></i> Criar Promoção</button>
        </div>

        <form id="new-promotion-form" class="admin-form" style="display: none; margin-top: var(--space-lg); border-top: 1px solid var(--admin-border-color); padding-top: var(--space-lg);">
          <h3>Criar Nova Promoção</h3>
          <div class="form-group">
            <label for="select-item-for-promotion">Item do Cardápio:</label><select id="select-item-for-promotion" required><option value="" disabled selected>Carregando...</option></select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="promotion-original-price">Preço Original (R$):</label><input type="text" id="promotion-original-price" readonly style="background-color:#e9ecef;">
            </div>
            <div class="form-group">
              <label for="promotion-new-price">Novo Preço Promocional (R$):</label><input type="number" id="promotion-new-price" step="0.01" min="0" required>
            </div>
          </div>
          <div class="form-group">
            <label for="promotion-description">Descrição (Opcional):</label><textarea id="promotion-description" rows="2" placeholder="Usará descrição original se vazio."></textarea>
          </div>
          <div class="form-group">
            <label for="promotion-points">Pontos para Resgate (Opcional):</label><input type="number" id="promotion-points" step="1" min="0" placeholder="Ex: 10">
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar</button>
            <button type="button" id="cancel-new-promotion-btn" class="btn btn-secondary">Cancelar</button>
          </div>
        </form>

        <div class="promotions-list-controls">
          <h3>Promoções Atuais</h3>
        </div>
        <div id="promotions-list-container">
          <p class="empty-list-message">
            Nenhuma promoção.
          </p>
        </div>
      </section>

      <section id="settings-content" class="admin-view">
        <div class="view-header">
          <h2><i class="fas fa-cog"></i> Configurações Gerais</h2>
        </div>
        <div class="settings-group">
          <h3><i class="fas fa-clock"></i> Horário de Funcionamento</h3>
          <div class="settings-content-wrapper">
            <form id="operating-hours-form" class="admin-form" style="padding:var(--space-md);box-shadow:none;border:none;">
              <div id="operating-hours-fields-container">
                <p>
                  Carregando horários...
                </p>
              </div>
              <div class="form-actions" style="margin-top:var(--space-md);">
                <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Horários</button>
              </div>
            </form>
          </div>
        </div>
        <div class="settings-group">
          <h3><i class="fas fa-motorcycle"></i> Taxas de Entrega</h3>
          <div class="settings-content-wrapper">
            <form id="neighborhood-form" class="admin-form" style="padding:var(--space-md);box-shadow:none;border:none;">
              <h4 id="neighborhood-form-title">Adicionar Novo Bairro</h4>
              <input type="hidden" id="neighborhood-id-hidden">
              <div class="form-row">
                <div class="form-group">
                  <label for="neighborhood-name">Nome do Bairro</label>
                  <input type="text" id="neighborhood-name" placeholder="Ex: Centro" required>
                </div>
                <div class="form-group">
                  <label for="neighborhood-fee">Taxa de Entrega (R$)</label>
                  <input type="number" id="neighborhood-fee" placeholder="Ex: 7.00" step="0.01" min="0" required>
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Bairro</button>
                <button type="button" id="cancel-edit-neighborhood-btn" class="btn btn-secondary hidden"><i class="fas fa-times"></i> Cancelar Edição</button>
              </div>
            </form>
            <div id="delivery-fees-admin-container" style="margin-top:var(--space-lg);">
              <p>
                Carregando taxas...
              </p>
            </div>
          </div>
        </div>
        <div class="settings-group">
          <h3><i class="fas fa-id-card-alt"></i> Entregadores</h3>
          <div class="settings-content-wrapper">
            <form id="delivery-person-form" class="admin-form" style="padding:var(--space-md);box-shadow:none;border:none;">
              <h4 id="delivery-person-form-title">Adicionar Novo Entregador</h4>
              <input type="hidden" id="delivery-person-id-hidden">
              <div class="form-row">
                <div class="form-group">
                  <label for="delivery-person-firstname">Nome</label>
                  <input type="text" id="delivery-person-firstname" placeholder="Ex: João" required>
                </div>
                <div class="form-group">
                  <label for="delivery-person-lastname">Sobrenome</label>
                  <input type="text" id="delivery-person-lastname" placeholder="Ex: Silva" required>
                </div>
              </div>
              <div class="form-group">
                <label for="delivery-person-whatsapp">WhatsApp (somente números com DDD)</label>
                <input type="tel" id="delivery-person-whatsapp" placeholder="Ex: 12999998888" required>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Entregador</button>
                <button type="button" id="cancel-edit-delivery-person-btn" class="btn btn-secondary hidden"><i class="fas fa-times"></i> Cancelar Edição</button>
              </div>
            </form>
            <div id="delivery-people-admin-container" style="margin-top:var(--space-lg);">
              <p>
                Carregando entregadores...
              </p>
            </div>
          </div>
        </div>
        <div class="settings-group">
          <h3><i class="fas fa-tags"></i> Cupons de Desconto</h3>
          <div class="settings-content-wrapper">
            <form id="coupon-form" class="admin-form" style="padding:var(--space-md);box-shadow:none;border:none;">
              <h4 id="coupon-form-title">Adicionar Novo Cupom</h4>
              <input type="hidden" id="coupon-id-hidden">
              <div class="form-row">
                <div class="form-group">
                  <label for="coupon-code">Código do Cupom (sem espaços, maiúsculas)</label>
                  <input type="text" id="coupon-code" placeholder="Ex: BEMVINDO10" required>
                </div>
                <div class="form-group">
                  <label for="coupon-description">Descrição</label>
                  <input type="text" id="coupon-description" placeholder="Ex: 10% na primeira compra" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="coupon-type">Tipo de Desconto</label>
                  <select id="coupon-type" required>
                    <option value="percentage">Porcentagem (%)</option>
                    <option value="fixed">Valor Fixo (R$)</option>
                    <option value="free_delivery">Entrega Grátis</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="coupon-value">Valor do Desconto</label>
                  <input type="number" id="coupon-value" placeholder="Ex: 10 ou 15.00" step="0.01" min="0" required>
                </div>
              </div>
              <div class="form-group">
                <label for="coupon-min-order-value">
                  Valor Mínimo do Pedido (Opcional)
                </label>
                <input type="number" id="coupon-min-order-value" placeholder="Ex: 100.00" step="0.01" min="0" class="form-control">
                <small>Se preenchido, o cupom só será válido para pedidos com subtotal acima deste valor. Deixe em branco ou 0 se não houver valor mínimo.</small>
              </div>
              <div class="form-group">
                <label class="closed-checkbox-label">
                  <input type="checkbox" id="coupon-one-time-use"> Limitar a um uso por cliente
                </label>
              </div>
              <div class="form-group">
                <label class="closed-checkbox-label">
                  <input type="checkbox" id="coupon-active" checked> Cupom Ativo
                </label>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Cupom</button>
                <button type="button" id="cancel-edit-coupon-btn" class="btn btn-secondary hidden"><i class="fas fa-times"></i> Cancelar Edição</button>
              </div>
            </form>
            <div id="coupons-admin-container" style="margin-top:var(--space-lg);">
              <p>
                Carregando cupons...
              </p>
            </div>
          </div>
        </div>
        <div class="settings-group">
          <h3><i class="fas fa-store-alt"></i> Dados da Loja</h3>
          <div class="settings-content-wrapper">
            <form id="store-info-form" class="admin-form" style="padding:var(--space-md);box-shadow:none;border:none;">
              <div class="form-group">
                <label for="store-min-order">Pedido Mínimo (R$):</label><input type="number" id="store-min-order" step="0.01" min="0" class="form-control">
              </div>
              <div class="form-actions" style="margin-top:var(--space-md);">
                <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Dados</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <div id="product-selection-modal" class="admin-modal">
        <div class="modal-content" style="max-width: 800px; height: 90vh;">
          <button class="close-modal-btn">&times;</button>
          <h3 style="flex-shrink: 0;"><i class="fas fa-plus-circle"></i> Adicionar Produtos ao Pedido</h3>
          <div class="modal-body" style="display: flex; flex-direction: column; gap: 16px; padding-top: 10px;">
            <div class="product-selection-controls" style="flex-shrink: 0;">
              <select id="product-category-filter" class="form-control"></select>
            </div>
            <div id="product-list-container" class="pdv-product-grid" style="overflow-y: auto; flex-grow: 1;">
              <p>
                Carregando produtos...
              </p>
            </div>
          </div>
          <div class="modal-footer" style="flex-shrink: 0;">
            <button type="button" class="btn btn-secondary close-modal-btn">Fechar</button>
          </div>
        </div>
      </div>

      <div id="order-details-modal" class="admin-modal">
        <div class="modal-content" style="max-width: 600px;">
          <button class="close-modal-btn" data-modal-id="order-details-modal">&times;</button>
          <h3 id="modal-order-title"><i class="fas fa-receipt"></i> Detalhes do Pedido</h3>
          <div class="modal-body">
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" onclick="alert('Função de impressão não implementada.');"><i class="fas fa-print"></i> Imprimir Pedido</button>
          </div>
        </div>
      </div>

      <div id="delivery-summary-modal" class="admin-modal">
        <div class="modal-content" style="max-width: 700px;">
          <button class="close-modal-btn">&times;</button>
          <h3><i class="fas fa-map-marked-alt"></i> Resumo de Entregas (Pedidos "A Caminho")</h3>
          <div id="delivery-summary-body" class="modal-body">
            <p>
              Calculando rota...
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary close-modal-btn">Fechar</button>
          </div>
        </div>
      </div>

      <div id="add-category-modal" class="admin-modal">
        <div class="modal-content" style="max-width: 500px;">
          <button class="close-modal-btn" data-modal-id="add-category-modal">&times;</button>
          <h3><i class="fas fa-folder-plus"></i> Adicionar Nova Categoria</h3>
          <form id="add-category-form" class="admin-form-modal">
            <div class="form-group">
              <label for="new-category-key">Chave da Categoria (ex: 'pizzas-novas', sem espaços, minúsculas):</label>
              <input type="text" id="new-category-key" required pattern="[a-z0-9-]+">
              <small>Use apenas letras minúsculas, números e hífens. Este será o identificador interno.</small>
            </div>
            <div class="form-group">
              <label for="new-category-name">Nome de Exibição da Categoria (ex: 'Pizzas Novas'):</label>
              <input type="text" id="new-category-name" required>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Categoria</button>
              <button type="button" class="btn btn-secondary close-modal-btn" data-modal-id="add-category-modal"></button>
            </div>
          </form>
        </div>
      </div>

      <div id="item-editor-modal" class="admin-modal">
        <div class="modal-content" style="max-width: 600px;">
          <button class="close-modal-btn" data-modal-id="item-editor-modal">&times;</button>
          <h3 id="item-editor-title"><i class="fas fa-pizza-slice"></i> Adicionar/Editar Item</h3>
          <form id="item-editor-form" class="admin-form-modal">
            <input type="hidden" id="edit-item-id">
            <input type="hidden" id="edit-item-category-key">
            <div class="form-group">
              <label for="item-name">Nome do Item:</label>
              <input type="text" id="item-name" required>
            </div>
            <div class="form-group">
              <label for="item-description">Descrição:</label>
              <textarea id="item-description" rows="3" placeholder="Ingredientes, detalhes..."></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="item-price">Preço (R$):</label>
                <input type="number" id="item-price" step="0.01" min="0" required>
              </div>
              <div class="form-group">
                <label for="item-image">URL da Imagem (Ex: ../img/pizzas/mucarela.png):</label>
                <input type="text" id="item-image" placeholder="Caminho relativo da imagem">
              </div>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Item</button>
            </div>
          </form>
        </div>
      </div>

      <div id="pdv-pizza-customization-modal" class="admin-modal">
        <div class="modal-content" style="max-width: 500px;">
          <button class="close-modal-btn">&times;</button>
          <div class="modal-scrollable-content">
            <h3 id="pdv-modal-product-name"></h3>
            <p id="pdv-modal-product-description"></p>
            <div id="pdv-selected-halves-info" class="hidden" style="margin-bottom: 15px; background-color: #f9f9f9; padding: 10px; border-radius: 5px;">
              <p style="margin: 0 0 5px 0;">
                <strong>Meio:</strong> <span id="pdv-first-half-name-display"></span>
              </p>
              <p style="margin: 0;">
                <strong>Meio:</strong> <span id="pdv-second-half-name-display"></span>
              </p>
            </div>
            <div class="options-section">
              <h4>Escolha o Tamanho:</h4>
              <div class="option-group">
                <label class="option-label">
                  <input type="radio" name="pdv-pizza-size" value="inteira" checked> Inteira
                  <span id="pdv-price-inteira" class="option-price"></span>
                </label>
              </div>
              <div class="option-group">
                <label class="option-label">
                  <input type="radio" name="pdv-pizza-size" value="metade"> Metade/Metade
                  <span id="pdv-price-metade" class="option-price"></span>
                </label>
              </div>
            </div>
            <div id="pdv-second-half-options" class="options-section hidden">
              <h4>Escolha a 2ª Metade:</h4>
              <div id="pdv-second-half-list" class="product-grid" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
            <div id="pdv-stuffed-crust-options-container" class="options-section">
              <h4>Borda Recheada (Opcional):</h4>
              <div id="pdv-stuffed-crust-type-list"></div>
            </div>
          </div>
          <div class="modal-fixed-bottom" style="padding: var(--space-md); border-top: 1px solid var(--admin-border-color);">
            <button id="pdv-add-pizza-to-cart-btn" class="btn btn-success" style="width: 100%;">Adicionar ao Pedido</button>
          </div>
        </div>
      </div>

      <div id="pdv-new-customer-modal" class="admin-modal">
        <div class="modal-content" style="max-width: 600px;">
          <button class="close-modal-btn">&times;</button>
          <h3><i class="fas fa-user-plus"></i> Cadastrar Novo Cliente</h3>
          <form id="pdv-new-customer-form" class="admin-form-modal">
            <div class="form-row">
              <div class="form-group">
                <label for="new-customer-firstname">Nome</label>
                <input type="text" id="new-customer-firstname" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="new-customer-lastname">Sobrenome</label>
                <input type="text" id="new-customer-lastname" class="form-control" required>
              </div>
            </div>
            <div class="form-group">
              <label for="new-customer-whatsapp">WhatsApp (somente números com DDD)</label>
              <input type="tel" id="new-customer-whatsapp" class="form-control" required>
            </div>
            <hr>
            <h4>Endereço de Entrega</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="new-customer-street">Rua / Avenida</label>
                <input type="text" id="new-customer-street" class="form-control">
              </div>
              <div class="form-group" style="flex-basis: 120px; flex-grow: 0;">
                <label for="new-customer-number">Número</label>
                <input type="text" id="new-customer-number" class="form-control">
              </div>
            </div>
            <div class="form-group">
              <label for="new-customer-neighborhood">Bairro</label>
              <select id="new-customer-neighborhood" class="form-control">
                <option value="" disabled selected>Selecione o bairro...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="new-customer-complement">Complemento</label>
              <input type="text" id="new-customer-complement" class="form-control" placeholder="Apto, casa, etc.">
            </div>
            <div class="form-group">
              <label for="new-customer-reference">Ponto de Referência</label>
              <input type="text" id="new-customer-reference" class="form-control">
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
              <button type="submit" class="btn btn-success"><i class="fas fa-check"></i> Usar este Cliente</button>
            </div>
          </form>
        </div>
      </div>

      <div id="edit-customer-modal" class="admin-modal">
        <div class="modal-content">
          <button class="close-modal-btn" data-modal-id="edit-customer-modal">&times;</button>
          <h3><i class="fas fa-user-edit"></i> Editar Cliente</h3>
          <form id="edit-customer-form" class="admin-form-modal">
          </form>
        </div>
      </div>

      <div id="pdv-discount-modal" class="admin-modal">
        <div class="modal-content" style="max-width: 550px;">
          <button class="close-modal-btn">&times;</button>
          <h3><i class="fas fa-tags"></i> Aplicar Desconto no Pedido</h3>
          <div class="modal-body">
            <div id="pdv-discount-loyalty-section">
              <h4>Usar Pontos de Fidelidade do Cliente</h4>
              <div id="pdv-loyalty-info">
                <p>
                  Cliente selecionado tem <strong id="pdv-customer-points-display">0</strong> ponto(s).
                </p>
              </div>
              <div id="pdv-loyalty-options-container">
                <p class="empty-list-message">
                  Nenhum resgate disponível com os pontos atuais.
                </p>
              </div>
            </div>
            <div id="pdv-discount-coupons-section" style="margin-top: 20px;">
              <h4>Usar Cupom de Desconto</h4>
              <div id="pdv-coupons-list-container">
                <p class="empty-list-message">
                  Nenhum cupom de desconto disponível no momento.
                </p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="pdv-remove-discount-btn" type="button" class="btn btn-danger" style="display: none; margin-right: auto;">Remover Desconto</button>
            <button id="pdv-confirm-discount-btn" type="button" class="btn btn-success">Aplicar Selecionado</button>
            <button type="button" class="btn btn-secondary close-modal-btn">Fechar</button>
          </div>
        </div>
      </div>

    </main>
  </div>

  <script type="module">
    // Importando módulos do App, Firestore e AGORA o de Autenticação com signOut
    import {
      initializeApp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc,
      getDocs,
      setDoc,
      updateDoc,
      collection,
      query,
      where,
      orderBy,
      onSnapshot,
      deleteDoc,
      writeBatch,
      serverTimestamp,
      Timestamp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // Sua configuração do Firebase (sem alterações)
    const firebaseConfig = {
      apiKey: "AIzaSyDMaD6Z3CDxdkyzQXHpV3b0QBWr--xQTso",
      authDomain: "app-ditalia.firebaseapp.com",
      projectId: "app-ditalia",
      storageBucket: "app-ditalia.firebasestorage.app",
      messagingSenderId: "122567535166",
      appId: "1:122567535166:web:19de7b8925042027063f6f",
      measurementId: "G-5QW3MVGYME"
    };

    // Inicialização
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app); // Obtém a instância de autenticação

    // ** O GUARDA DE PROTEÇÃO **
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // O usuário está logado! Prossiga e carregue o painel.
        console.log("Usuário autenticado:", user.uid);

        // Disponibiliza as funções do Firestore globalmente para os outros scripts
        window.firebaseApp = app;
        window.db = db;
        window.firebaseFirestore = {
          doc,
          getDoc,
          getDocs,
          setDoc,
          updateDoc,
          collection,
          query,
          where,
          orderBy,
          onSnapshot,
          deleteDoc,
          writeBatch,
          serverTimestamp,
          Timestamp
        };

        // Chama a função principal do admin.js para iniciar o painel
        if (typeof startAdminPanel === 'function') {
          startAdminPanel();
        } else {
          console.error("ERRO GRAVE: A função startAdminPanel() do admin.js não foi encontrada.");
        }

        // =======================================================
        // NOVO: LÓGICA DO BOTÃO DE LOGOUT
        // =======================================================
        const logoutButton = document.getElementById('logout-button');
        if (logoutButton) {
          logoutButton.addEventListener('click', (e) => {
            e.preventDefault();

            signOut(auth).then(() => {
              // Logout bem-sucedido
              console.log('Usuário deslogado com sucesso.');
              window.location.href = 'login.html'; // Redireciona para a página de login
            }).catch((error) => {
              // Ocorreu um erro
              console.error('Erro ao fazer logout:', error);
              alert("Ocorreu um erro ao tentar sair. Tente novamente.");
            });
          });
        }
        // =======================================================
        // FIM DA LÓGICA DE LOGOUT
        // =======================================================

      } else {
        // O usuário NÃO está logado! Redireciona para a página de login.
        console.log("Nenhum usuário autenticado. Redirecionando para /login.html");
        window.location.href = 'login.html';
      }
    });
  </script>
  
  <script src="appearance.js" defer></script>
  <script src="config.js" defer></script>
  <!--<script src="admin.js" defer></script>-->
  <script src="cardapio.js" defer></script>
  <script src="promocoes.js" defer></script>
  <script src="pedidos.js" defer></script>
  <script src="clientes.js" defer></script>
  <script src="vendas.js" defer></script>
  <script src="pdv.js" defer></script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw-admin.js')
          .then((reg) => console.log('Service Worker do Admin registrado com sucesso!', reg.scope))
          .catch((err) => console.log('Falha ao registrar Service Worker do Admin: ', err));
      });
    }
  </script>
  
</body>
</html>
