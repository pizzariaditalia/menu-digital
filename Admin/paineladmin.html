<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D'Italia Pizzaria - Admin</title>
  <link rel="manifest" href="manifest-admin.json">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<link rel="stylesheet" href="styleadmin.css">
<link rel="stylesheet" href="styleadmin-2.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/eruda"></script>
<script>
  eruda.init();
</script>
</head>

<body>
<div class="admin-app-container">
<header class="admin-top-bar">
<div class="logo-container">
</div>

<div class="header-actions-right">
<!-- <button id="admin-enable-notifications-btn" class="menu-drawer-button" title="Ativar notifica√ß√µes neste dispositivo">
    <i class="fas fa-bell-slash"></i>
  </button> -->
<button id="notification-bell" class="menu-drawer-button">
<i class="fas fa-bell"></i>
<span id="notification-badge" class="notification-badge hidden"></span>
</button>
<button id="open-drawer-menu" class="menu-drawer-button">
<i class="fas fa-bars"></i>
<span>Menu</span>
</button>
</div>
</header>

<nav id="admin-drawer-menu" class="admin-drawer">
<div class="drawer-header">
<h3>Menu Principal</h3>
<button id="close-drawer-menu" class="close-drawer-btn">&times;</button>
</div>
<ul>
<li class="active-link"><a href="#" data-section-target="orders-content"><i class="fas fa-receipt"></i> Pedidos</a></li>
<li><a href="#" data-section-target="map-view"><i class="fas fa-map-marked-alt"></i> Mapa em Tempo Real</a></li>
<li><a href="#" data-section-target="pdv-content"><i class="fas fa-cash-register"></i> PDV (Ponto de Venda)</a></li>
<li><a href="#" data-section-target="vendas-view"><i class="fas fa-chart-line"></i> Relat√≥rio de Vendas</a></li>
<li><a href="#" data-section-target="financeiro-view"><i class="fas fa-dollar-sign"></i> Gest√£o Financeira</a></li>
<li><a href="#" data-section-target="saques-view"><i class="fas fa-hand-holding-usd"></i> Solicita√ß√µes de Saque</a></li>
<li><a href="#" data-section-target="cardapio-view"><i class="fas fa-utensils"></i> Gerenciar Card√°pio</a></li>
<li><a href="#" data-section-target="customers-content"><i class="fas fa-users"></i> Clientes</a></li>
<li><a href="#" data-section-target="import-view"><i class="fas fa-file-import"></i> Importar Clientes</a></li>
<li><a href="#" data-section-target="comunicados-view"><i class="fab fa-whatsapp"></i> Comunicados</a></li>
<li><a href="#" data-section-target="promotions-content"><i class="fas fa-tags"></i> Promo√ß√µes</a></li>
<li><a href="#" data-section-target="appearance-view"><i class="fas fa-paint-brush"></i> Apar√™ncia do Site</a></li>
<li><a href="#" data-section-target="settings-content"><i class="fas fa-cog"></i> Configura√ß√µes</a></li>
<li><hr></li>
<li><a href="../index.html" target="_blank"><i class="fas fa-store"></i> Ver Site Principal</a></li>
<li><hr></li>
<li><a href="#" id="logout-button"><i class="fas fa-sign-out-alt"></i> Sair (Logout)</a></li>
</ul>
</nav>

<div class="drawer-overlay" id="drawer-overlay"></div>

<main class="admin-main-content">

<section id="map-view" class="admin-view">
<div class="view-header">
<h2><i class="fas fa-map-marked-alt"></i> Localiza√ß√£o dos Entregadores</h2>
</div>
<p class="form-instruction">
Acompanhe em tempo real a posi√ß√£o dos entregadores que est√£o com o aplicativo aberto. O mapa ser√° centralizado no primeiro entregador ativo.
</p>
<div id="realtime-map-container" style="height: 75vh; border-radius: 8px; border: 1px solid var(--admin-border-color); background-color: #f0f2f5;">
</div>
</section>

<section id="financeiro-view" class="admin-view">
<div class="view-header">
<h2><i class="fas fa-dollar-sign"></i> Gest√£o Financeira</h2>
</div>

<div class="admin-form" style="margin-bottom: var(--space-lg);">
<div class="form-row">
<div class="form-group">
<label for="financial-start-date">Data de In√≠cio</label>
<input type="date" id="financial-start-date" class="form-control">
</div>
<div class="form-group">
<label for="financial-end-date">Data de Fim</label>
<input type="date" id="financial-end-date" class="form-control">
</div>
<div class="form-actions">
<button id="filter-financial-btn" class="btn btn-primary"><i class="fas fa-filter"></i> Analisar Per√≠odo</button>
</div>
</div>
</div>

<div class="sales-summary-container-v2">
<div class="summary-box-v2">
<div class="icon">
<i class="fas fa-cash-register"></i>
</div>
<div class="text">
<span class="label">Faturamento Bruto (Vendas)</span>
<span class="value" id="faturamento-bruto-value">R$ 0,00</span>
</div>
</div>
<div class="summary-box-v2">
<div class="icon" style="color: var(--admin-danger-red); background-color: #f8d7da;">
<i class="fas fa-arrow-down"></i>
</div>
<div class="text">
<span class="label">Despesas Totais</span>
<span class="value" id="despesas-totais-value">R$ 0,00</span>
</div>
</div>
<div class="summary-box-v2">
<div class="icon" style="color: var(--admin-success-green); background-color: #d1e7dd;">
<i class="fas fa-chart-pie"></i>
</div>
<div class="text">
<span class="label">Lucro L√≠quido</span>
<span class="value" id="lucro-liquido-value">R$ 0,00</span>
</div>
</div>
<div class="summary-box-v2">
<div class="icon" style="color: var(--admin-secondary-gray); background-color: #e2e3e5;">
<i class="fas fa-ticket-alt"></i>
</div>
<div class="text">
<span class="label">Ticket M√©dio</span>
<span class="value" id="ticket-medio-value">R$ 0,00</span>
</div>
</div>
</div>

<div class="admin-form" style="margin-top: var(--space-lg);">
<h3><i class="fas fa-plus-circle"></i> Adicionar Novo Lan√ßamento</h3>
<form id="lancamento-form">
<div class="form-row">
<div class="form-group" style="flex: 2;">
<label for="lancamento-descricao">Descri√ß√£o</label>
<input type="text" id="lancamento-descricao" placeholder="Ex: Compra de queijo, Sal√°rio, Conta de luz" required>
</div>
<div class="form-group">
<label for="lancamento-valor">Valor (R$)</label>
<input type="number" id="lancamento-valor" step="0.01" min="0" required>
</div>
<div class="form-group">
<label for="lancamento-tipo">Tipo</label>
<select id="lancamento-tipo" required>
<option value="saida">Sa√≠da (Despesa)</option>
<option value="entrada">Entrada (Outros)</option>
</select>
</div>
<div class="form-group">
<label for="lancamento-data">Data do Lan√ßamento</label>
<input type="date" id="lancamento-data" required>
</div>
</div>
<div class="form-actions">
<button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Lan√ßamento</button>
</div>
</form>
</div>

<div id="lancamentos-history-container" style="margin-top: var(--space-lg);">
<p class="empty-list-message">
Carregando lan√ßamentos...
</p>
</div>
</section>

<section id="comunicados-view" class="admin-view">
<div class="view-header">
<h2><i class="fab fa-whatsapp"></i> Envio de Comunicados</h2>
</div>

<div class="admin-form">
<h3>1. Crie seu Comunicado</h3>
<p class="form-instruction">
Preencha os campos abaixo para enviar uma notifica√ß√£o push para todos os clientes ou gerar uma lista para envio no WhatsApp.
</p>

<div class="form-group">
<label for="template-selecao-mensagem">Tipo de Mensagem (Opcional):</label>
<select id="template-selecao-mensagem" class="form-control">
<option value="">-- Selecione um modelo --</option>
</select>
<small class="form-instruction">Escolha um modelo para preencher o t√≠tulo e a mensagem abaixo automaticamente.</small>
</div>

<div class="form-group">
<label for="comunicado-titulo">T√≠tulo da Notifica√ß√£o Push:</label>
<input type="text" id="comunicado-titulo" class="form-control" placeholder="Ex: Sextou com Pizza! üçï">
</div>

<div class="form-group">
<label for="comunicado-mensagem">Corpo da Mensagem:</label>
<textarea id="comunicado-mensagem" rows="4" class="form-control"></textarea>
<small class="form-instruction">Use <strong>{nome_cliente}</strong> para personalizar mensagens de WhatsApp. Para notifica√ß√µes Push, essa personaliza√ß√£o n√£o ser√° aplicada.</small>
</div>

<div class="form-actions" style="justify-content: flex-start; gap: 12px; flex-wrap: wrap;">
<button id="enviar-notificacao-push-btn" class="btn btn-success"><i class="fas fa-paper-plane"></i> Enviar Notifica√ß√£o Push</button>
<button id="gerar-links-envio" class="btn btn-primary"><i class="fas fa-list"></i> Gerar Lista de Clientes (WhatsApp)</button>
<button id="enviar-lote-selecionado-btn" class="btn btn-success hidden"><i class="fab fa-whatsapp"></i> Enviar para Selecionados (WhatsApp)</button>
</div>
</div>

<div id="lista-envio-whatsapp-container" class="hidden" style="margin-top: var(--space-lg);">
<h3>2. Lista de Clientes (para WhatsApp)</h3>
<div id="lista-envio-whatsapp" class="table-responsive" style="max-height: 500px;">
</div>
</div>
</section>

<section id="import-view" class="admin-view">
<div class="view-header">
<h2><i class="fas fa-file-import"></i> Importar Clientes de Planilha (CSV)</h2>
</div>

<div class="admin-form">
<h3>Passo 1: Selecione o Arquivo CSV</h3>
<p class="form-instruction">
Prepare sua planilha com as colunas: <strong>nome, sobrenome, whatsapp, endereco</strong>. Depois, salve como CSV e selecione o arquivo abaixo.
</p>
<div class="form-group">
<input type="file" id="csv-file-input" accept=".csv" class="form-control">
</div>
<div class="form-actions" style="justify-content: flex-start;">
<button id="process-csv-btn" class="btn btn-primary"><i class="fas fa-cogs"></i> Carregar e Pr√©-visualizar</button>
</div>
</div>

<div id="csv-preview-container" class="hidden" style="margin-top: var(--space-lg);">
<h3>Passo 2: Pr√©-visualiza√ß√£o dos Dados</h3>
<p class="form-instruction">
Verifique se os dados abaixo est√£o corretos antes de importar.
</p>
<div id="csv-preview-area" class="table-responsive" style="max-height: 400px;"></div>
<div class="form-actions" style="margin-top: var(--space-md); justify-content: flex-start;">
<button id="confirm-import-btn" class="btn btn-success btn-lg"><i class="fas fa-check-circle"></i> Confirmar e Importar Clientes</button>
</div>
</div>
</section>

<section id="appearance-view" class="admin-view">
<div class="view-header">
<h2><i class="fas fa-paint-brush"></i> Apar√™ncia do Site</h2>
</div>
<p class="form-instruction">
Altere as imagens e cores do seu site principal. Para as imagens, coloque o arquivo na pasta do projeto (ex: `img/logos/`) e insira o caminho correto no campo de texto.
</p>

<form id="appearance-form" class="admin-form">
<div class="settings-group active">
<h3><i class="fas fa-image"></i> Imagens Principais</h3>
<div class="settings-content-wrapper" style="display: block;">
<div class="form-row">
<div class="form-group">
<label for="logo-path-input">Caminho para o Logo</label>
<input type="text" id="logo-path-input" class="form-control" placeholder="Ex: img/logos/logo.png">
</div>
<div class="form-group">
<label for="banner-path-input">Caminho para o Banner</label>
<input type="text" id="banner-path-input" class="form-control" placeholder="Ex: img/banner/banner4.jpg">
</div>
</div>
</div>
</div>

<div class="settings-group active">
<h3><i class="fas fa-film"></i> Gerenciamento do Carrossel</h3>
<div class="settings-content-wrapper" style="display: block; padding: var(--space-lg);">

<p class="form-instruction">
Adicione ou remova v√≠deos da "playlist" do carrossel. Os arquivos de v√≠deo j√° devem existir na pasta <strong>/img/banner/</strong> do seu projeto.
</p>

<div id="carousel-videos-list" class="image-preview-grid">
<p>
Carregando v√≠deos...
</p>
</div>

<hr style="margin: var(--space-lg) 0;">

<h4 style="margin-top: 0;">Adicionar V√≠deo ao Carrossel</h4>
<div class="form-group">
<label for="carousel-video-filename-input">Nome do Arquivo (ex: video1.mp4)</label>
<div class="input-with-button">
<input type="text" id="carousel-video-filename-input" class="form-control" placeholder="Digite o nome exato do arquivo...">
<button type="button" id="add-video-btn" class="btn btn-primary">Adicionar</button>
</div>
</div>

</div>
</div>

<div class="settings-group active" style="margin-top: 2rem;">
<h3><i class="fas fa-palette"></i> Esquema de Cores</h3>
<div class="settings-content-wrapper" style="display: block;">
<div class="form-row">
<div class="form-group">
<label for="primary-color-input">Cor Principal (bot√µes, detalhes)</label>
<input type="color" id="primary-color-input" class="form-control-color">
</div>
<div class="form-group">
<label for="background-color-input">Cor de Fundo Principal</label>
<input type="color" id="background-color-input" class="form-control-color">
</div>
</div>
</div>
</div>

<div class="form-actions" style="margin-top: 2rem;">
<button type="submit" class="btn btn-success btn-lg"><i class="fas fa-save"></i> Salvar Altera√ß√µes de Apar√™ncia</button>
</div>
</form>
</section>

<section id="cardapio-view" class="admin-view">
<div class="view-header">
<h2><i class="fas fa-utensils"></i> Gerenciar Card√°pio</h2>
<button id="add-category-button" class="btn btn-primary"><i class="fas fa-plus"></i> Nova Categoria</button>
</div>
<div id="category-list-container">
<p>
Carregando categorias...
</p>
</div>

<div class="settings-group active" style="margin-top: 2rem; border-top: 2px solid var(--admin-border-color); padding-top: 1rem;">
<h3 style="padding: 0 1rem; cursor: default;"><i class="fas fa-cheese"></i> Gerenciar Bordas Recheadas</h3>
<div class="settings-content-wrapper" style="padding: 1rem; display: block;">
<form id="stuffed-crust-form" class="admin-form" style="padding:var(--space-md); box-shadow: var(--admin-shadow-sm); border: 1px solid var(--admin-border-color); border-radius: var(--admin-border-radius-md); margin-bottom: 2rem;">
<h4 id="stuffed-crust-form-title">Adicionar Nova Borda</h4>
<input type="hidden" id="stuffed-crust-id-hidden">
<div class="form-row">
<div class="form-group">
<label for="stuffed-crust-name">Nome da Borda</label>
<input type="text" id="stuffed-crust-name" placeholder="Ex: Catupiry" required>
</div>
<div class="form-group">
<label for="stuffed-crust-price">Pre√ßo Adicional (R$)</label>
<input type="number" id="stuffed-crust-price" placeholder="Ex: 10.00" step="0.01" min="0" required>
</div>
<div class="form-group">
<label for="stuffed-crust-type">Tipo de Borda</label>
<select id="stuffed-crust-type" required>
<option value="salgada" selected>Salgada</option>
<option value="doce">Doce</option>
</select>
</div>
</div>
<div class="form-actions">
<button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Borda</button>
<button type="button" id="cancel-edit-stuffed-crust-btn" class="btn btn-secondary hidden"><i class="fas fa-times"></i> Cancelar Edi√ß√£o</button>
</div>
</form>
<div id="stuffed-crust-list-container">
<p>
Carregando bordas...
</p>
</div>
</div>
</div>
</section>

<section id="pdv-content" class="admin-view">
<div id="pdv-initial-state">
<div class="view-header">
<h2><i class="fas fa-cash-register"></i> PDV - Ponto de Venda</h2>
</div>
<p>
Bem-vindo ao Ponto de Venda!
</p>
<button id="start-new-pdv-order" class="btn btn-primary btn-lg"><i class="fas fa-plus-circle"></i> Iniciar Novo Pedido</button>
</div>
<div id="pdv-order-creation-view" class="hidden">
<div class="view-header">
<h2><i class="fas fa-plus-circle"></i> Novo Pedido no PDV</h2>
<button id="pdv-cancel-btn" class="btn btn-secondary-outline"><i class="fas fa-times"></i> Cancelar e Voltar</button>
</div>
<div class="pdv-layout-container">
<div class="pdv-order-column">
<div class="pdv-card">
<div class="pdv-card-header">
<h3 class="pdv-card-title"><i class="fas fa-concierge-bell"></i> Tipo de Pedido</h3>
</div>
<div class="pdv-card-body pdv-order-type-selector">
<label>
<input type="radio" name="pdv-order-type" value="Delivery" checked>
<span><i class="fas fa-motorcycle"></i> Delivery</span>
</label>
<label>
<input type="radio" name="pdv-order-type" value="Balcao">
<span><i class="fas fa-store-alt"></i> Retirada</span>
</label>
<label>
<input type="radio" name="pdv-order-type" value="Mesa">
<span><i class="fas fa-utensils"></i> Mesa</span>
</label>
</div>
</div>
<div class="pdv-card">
<h3 class="pdv-card-title"><i class="fas fa-user-circle"></i> Cliente</h3>
<div class="pdv-card-body">
<div class="form-group">
<label class="pdv-card-title">Buscar ou Adicionar Cliente (Nome/WhatsApp)</label>
<div class="input-with-icon right-icon">
<input type="text" id="pdv-customer-search" class="form-control" placeholder="Digite para buscar...">
<button id="pdv-add-new-customer-btn" class="pdv-icon-btn" title="Cadastrar Novo Cliente">
<i class="fas fa-user-plus"></i>
</button>
</div>
</div>
<div id="pdv-customer-details-container" class="hidden">
<hr class="pdv-divider">
<h4 class="pdv-details-title">Dados de Entrega</h4>
<div id="pdv-customer-address-display" class="pdv-address-display"></div>
</div>
</div>
</div>
<div class="pdv-card">
<div class="pdv-card-header">
<h3 class="pdv-card-title"><i class="fas fa-shopping-basket"></i> Itens do Pedido</h3>
<button id="pdv-add-product-btn" class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> Adicionar Produtos</button>
</div>
<div class="pdv-card-body">
<div id="pdv-cart-items" class="pdv-cart-items-list">
<p class="empty-cart-text">
Adicione produtos ao pedido
</p>
</div>
</div>
</div>
<div class="pdv-card">
<h3 class="pdv-card-title"><i class="far fa-comment-alt"></i> Observa√ß√µes</h3>
<div class="pdv-card-body">
<div class="form-group" style="margin-bottom: 0;">
<textarea id="pdv-order-notes" rows="3" class="form-control" placeholder="Observa√ß√µes gerais do pedido. Ex: Ligar antes de sair para entregar."></textarea>
</div>
</div>
</div>
</div>
<div class="pdv-summary-column">
<div class="pdv-card sticky-card">
<h3 class="pdv-card-title"><i class="fas fa-file-invoice-dollar"></i> Resumo e Pagamento</h3>
<div class="pdv-card-body">
<div class="pdv-totals">
<div class="summary-line">
<span>Subtotal Produtos (0)</span>
<span id="pdv-subtotal">R$ 0,00</span>
</div>
<div class="summary-line" id="pdv-delivery-fee-line">
<span>Entrega</span>
<div>
<span id="pdv-delivery-fee">R$ 0,00</span>
<button class="edit-fee-btn" title="Editar taxa manualmente"><i class="fas fa-pencil-alt"></i></button>
</div>
</div>
<div class="summary-line" id="pdv-discount-line" style="display: none;">
<span style="color: var(--admin-success-green);">Desconto Aplicado</span>
<span id="pdv-discount-amount" style="color: var(--admin-success-green); font-weight: 500;">- R$ 0,00</span>
</div>
</div>
<div class="form-group">
<button class="btn btn-secondary-outline btn-sm" id="pdv-apply-discount-btn" style="width: 100%;"><i class="fas fa-tag"></i> Aplicar Desconto ou Cupom</button>
</div>
<hr class="pdv-divider">
<div id="pdv-payment-section">
<div class="form-group">
<label for="pdv-payment-method" class="form-label">Forma de Pagamento</label>
<select id="pdv-payment-method" class="form-control">
<option value="" selected disabled>Selecione...</option>
<option value="Dinheiro">Dinheiro</option>
<option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
<option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option>
<option value="Pix">Pix</option>
</select>
</div>
<div id="pdv-change-for-container" class="payment-details-container hidden">
<label for="pdv-change-for" class="form-label">Troco para (R$)</label>
<input type="number" id="pdv-change-for" class="form-control" placeholder="Ex: 50.00">
</div>
<div id="pdv-pix-status-container" class="payment-details-container hidden">
<label class="form-label">Status do Pagamento Pix</label>
<div class="pix-status-options">
<label><input type="radio" name="pix-status" value="pago" checked> Pago</label>
<label><input type="radio" name="pix-status" value="nao-pago"> N√£o Pago</label>
</div>
</div>
</div>
<hr class="pdv-divider">
<div class="form-group" id="pdv-delivery-person-group">
<label for="pdv-delivery-person">Atribuir Entregador</label>
<div class="input-with-icon right-icon">
<select id="pdv-delivery-person" class="form-control">
<option value="">N√£o atribuir (Retirada)</option>
</select>
<button class="pdv-icon-btn whatsapp" title="Enviar dados do pedido para o WhatsApp do entregador">
<i class="fab fa-whatsapp"></i>
</button>
</div>
</div>
</div>
<div class="pdv-footer-summary">
<div class="pdv-grand-total">
<span id="pdv-payment-status" class="pdv-payment-status not-paid">N√£o pago</span>
<div class="total-amount">
<span>Total</span>
<strong id="pdv-total">R$ 0,00</strong>
</div>
</div>
<div class="pdv-actions-footer">
<button id="pdv-accept-btn" class="btn btn-success btn-lg">Confirmar Pedido</button>
</div>
</div>
</div>
</div>
</div>
</div>
</section>

<section id="orders-content" class="admin-view">
<div class="order-summary-bar">
<div id="notification-banner" class="notification-banner" style="display: none;">
<span>Deseja receber notifica√ß√µes de novos pedidos?</span>
<button id="enable-notifications-btn" class="btn btn-sm btn-success">Ativar</button>
</div>
<div class="summary-item" data-type-filter="balcao">
<i class="fas fa-store-alt"></i>
<span>Balc√£o</span>
<span class="count">0</span>
</div>
<div class="summary-item" data-type-filter="delivery">
<i class="fas fa-motorcycle"></i>
<span>Delivery</span>
<span class="count">0</span>
</div>
<div class="summary-item" data-type-filter="mesas">
<i class="fas fa-utensils"></i>
<span>Mesas</span>
<span class="count">0</span>
</div>
<div class="summary-options">
<i class="fas fa-ellipsis-v"></i>
</div>
</div>
<div class="order-actions-toolbar">
<button class="btn btn-primary btn-lg new-order-main-btn">
<i class="fas fa-plus-circle"></i> Novo pedido
</button>
</div>

<div class="order-status-filters">
<button class="btn filter-tab active" data-status-filter="todos">Tudo</button>
<button class="btn filter-tab" data-status-filter="pendente">Pendente <span class="count">0</span></button>
<button class="btn filter-tab" data-status-filter="em-preparo">Em preparo <span class="count">0</span></button>
<button class="btn filter-tab" data-status-filter="a-caminho">A caminho <span class="count">0</span></button>
</div>
<div id="orders-list-container" class="orders-list-table-wrapper empty">
<div class="empty-orders-state">
<i class="fas fa-utensils empty-state-icon"></i>
<p class="empty-state-message">
Nenhum pedido ativo.
</p>
<button class="btn btn-primary btn-lg empty-state-new-order-btn"><i class="fas fa-plus-circle"></i> Novo pedido</button>
</div>
</div>
</section>

<section id="vendas-view" class="admin-view">
<div class="view-header">
<h2><i class="fas fa-chart-line"></i> Relat√≥rio de Vendas</h2>
</div>

<div class="admin-form sales-filter-form" style="margin-bottom: var(--space-lg);">
<div class="form-row">
<div class="form-group">
<label for="sales-start-date">Data de In√≠cio</label>
<input type="date" id="sales-start-date" class="form-control">
</div>
<div class="form-group">
<label for="sales-end-date">Data de Fim</label>
<input type="date" id="sales-end-date" class="form-control">
</div>
<div class="form-actions">
<button id="filter-sales-btn" class="btn btn-primary"><i class="fas fa-filter"></i> Filtrar</button>
</div>
</div>
</div>

<div class="sales-summary-container-v2">
<div class="summary-box-v2">
<div class="icon">
<i class="fas fa-dollar-sign"></i>
</div>
<div class="text">
<span class="label">Faturamento Total no Per√≠odo</span>
<span class="value" id="sales-total-value">R$ 0,00</span>
</div>
</div>
<div class="summary-box-v2">
<div class="icon">
<i class="fas fa-receipt"></i>
</div>
<div class="text">
<span class="label">Quantidade de Pedidos</span>
<span class="value" id="sales-total-count">0</span>
</div>
</div>
<div class="summary-box-v2">
<div class="icon" style="background-color: #f0f6ff;">
<i class="fas fa-eye" style="color: #0d6efd;"></i>
</div>
<div class="text">
<span class="label">Acessos ao Card√°pio no Per√≠odo</span>
<span class="value" id="sales-total-visits">0</span>
</div>
</div>
<div class="summary-box-v2">
<div class="icon">
<i class="fas fa-motorcycle"></i>
</div>
<div class="text">
<span class="label">Total em Taxas de Entrega</span>
<span class="value" id="sales-total-delivery-fees">R$ 0,00</span>
</div>
</div>
</div>

<div id="payment-method-summary" class="payment-summary-grid">
</div>

<div id="bestsellers-section-container" class="bestsellers-container" style="display: none;">
<h4><i class="fas fa-star"></i> Top 5 Produtos Mais Vendidos</h4>
<ul id="bestsellers-list" class="top5-list">
</ul>
</div>

<div id="sales-list-container" style="margin-top: var(--space-lg);">
<p class="empty-list-message">
Selecione um per√≠odo para ver os pedidos.
</p>
</div>
</section>

<section id="customers-content" class="admin-view">
<div class="view-header">
<h2><i class="fas fa-users"></i> Clientes Cadastrados</h2>
</div>
<div class="customers-list-controls admin-form" style="margin-bottom:var(--space-lg);padding:var(--space-md);">
<div class="form-group">
<label for="search-customer-input">Buscar Cliente (Nome/WhatsApp):</label><input type="text" id="search-customer-input" placeholder="Digite para buscar...">
</div>
</div>
<div id="customers-list-container" class="customers-list-table-wrapper">
<p class="empty-list-message">
Nenhum cliente.
</p>
</div>
</section>

<section id="promotions-content" class="admin-view">
<div class="view-header">
<h2><i class="fas fa-tags"></i> Gerenciar Promo√ß√µes</h2><button id="toggle-new-promotion-form-btn" class="btn btn-primary"><i class="fas fa-plus"></i> Criar Promo√ß√£o</button>
</div>

<form id="new-promotion-form" class="admin-form" style="display: none; margin-top: var(--space-lg); border-top: 1px solid var(--admin-border-color); padding-top: var(--space-lg);">
<h3 id="new-promotion-form-title">Criar Nova Promo√ß√£o</h3>
<input type="hidden" id="promotion-id-hidden">

<div class="form-group">
<label for="select-item-for-promotion">Item do Card√°pio:</label><select id="select-item-for-promotion" required><option value="" disabled selected>Carregando...</option></select>
</div>
<div class="form-row">
<div class="form-group">
<label for="promotion-original-price">Pre√ßo Original (R$):</label><input type="text" id="promotion-original-price" readonly style="background-color:#e9ecef;">
</div>
<div class="form-group">
<label for="promotion-new-price">Novo Pre√ßo Promocional (R$):</label><input type="number" id="promotion-new-price" step="0.01" min="0" required>
</div>
</div>
<div class="form-group">
<label for="promotion-description">Descri√ß√£o (Opcional):</label><textarea id="promotion-description" rows="2" placeholder="Usar√° descri√ß√£o original se vazio."></textarea>
</div>
<div class="form-group">
<label for="promotion-points">Pontos para Resgate (Opcional):</label><input type="number" id="promotion-points" step="1" min="0" placeholder="Ex: 10">
</div>
<div class="form-actions">
<button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar</button>
<button type="button" id="cancel-new-promotion-btn" class="btn btn-secondary">Cancelar</button>
</div>
</form>

<div class="promotions-list-controls">
<h3>Promo√ß√µes Atuais</h3>
</div>
<div id="promotions-list-container">
<p class="empty-list-message">
Nenhuma promo√ß√£o.
</p>
</div>
</section>

<section id="settings-content" class="admin-view">
<div class="view-header">
<h2><i class="fas fa-cog"></i> Configura√ß√µes Gerais</h2>
</div>
<div class="settings-group">
<h3><i class="fas fa-clock"></i> Hor√°rio de Funcionamento</h3>
<div class="settings-content-wrapper">
<form id="operating-hours-form" class="admin-form" style="padding:var(--space-md);box-shadow:none;border:none;">
<div id="operating-hours-fields-container">
<p>
Carregando hor√°rios...
</p>
</div>
<div class="form-actions" style="margin-top:var(--space-md);">
<button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Hor√°rios</button>
</div>
</form>
</div>
</div>
<div class="settings-group">
<h3><i class="fas fa-motorcycle"></i> Taxas de Entrega</h3>
<div class="settings-content-wrapper">
<form id="neighborhood-form" class="admin-form" style="padding:var(--space-md);box-shadow:none;border:none;">
<h4 id="neighborhood-form-title">Adicionar Novo Bairro</h4>
<input type="hidden" id="neighborhood-id-hidden">
<div class="form-row">
<div class="form-group">
<label for="neighborhood-name">Nome do Bairro</label>
<input type="text" id="neighborhood-name" placeholder="Ex: Centro" required>
</div>
<div class="form-group">
<label for="neighborhood-fee">Taxa de Entrega (R$)</label>
<input type="number" id="neighborhood-fee" placeholder="Ex: 7.00" step="0.01" min="0" required>
</div>
</div>
<div class="form-actions">
<button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Bairro</button>
<button type="button" id="cancel-edit-neighborhood-btn" class="btn btn-secondary hidden"><i class="fas fa-times"></i> Cancelar Edi√ß√£o</button>
</div>
</form>
<div id="delivery-fees-admin-container" style="margin-top:var(--space-lg);">
<p>
Carregando taxas...
</p>
</div>
</div>
</div>
<div class="settings-group">
<h3><i class="fas fa-id-card-alt"></i> Entregadores</h3>
<div class="settings-content-wrapper">
<form id="delivery-person-form" class="admin-form" style="padding:var(--space-md);box-shadow:none;border:none;">
<h4 id="delivery-person-form-title">Adicionar Novo Entregador</h4>
<input type="hidden" id="delivery-person-id-hidden">
<div class="form-row">
<div class="form-group">
<label for="delivery-person-firstname">Nome</label>
<input type="text" id="delivery-person-firstname" placeholder="Ex: Jo√£o" required>
</div>
<div class="form-group">
<label for="delivery-person-lastname">Sobrenome</label>
<input type="text" id="delivery-person-lastname" placeholder="Ex: Silva" required>
</div>
<div class="form-group">
<label for="delivery-person-email">E-mail (usado para o login com Google)</label>
<input type="email" id="delivery-person-email" class="form-control" placeholder="Ex: entregador@gmail.com" required>
</div>
</div>
<div class="form-group">
<label for="delivery-person-whatsapp">WhatsApp (somente n√∫meros com DDD)</label>
<input type="tel" id="delivery-person-whatsapp" placeholder="Ex: 12999998888" required>
</div>
<div class="form-actions">
<button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Entregador</button>
<button type="button" id="cancel-edit-delivery-person-btn" class="btn btn-secondary hidden"><i class="fas fa-times"></i> Cancelar Edi√ß√£o</button>
</div>
</form>
<div id="delivery-people-admin-container" style="margin-top:var(--space-lg);">
<p>
Carregando entregadores...
</p>
</div>
</div>
</div>
<div class="settings-group">
<h3><i class="fas fa-tags"></i> Cupons de Desconto</h3>
<div class="settings-content-wrapper">
<form id="coupon-form" class="admin-form" style="padding:var(--space-md);box-shadow:none;border:none;">
<h4 id="coupon-form-title">Adicionar Novo Cupom</h4>
<input type="hidden" id="coupon-id-hidden">
<div class="form-row">
<div class="form-group">
<label for="coupon-code">C√≥digo do Cupom (sem espa√ßos, mai√∫sculas)</label>
<input type="text" id="coupon-code" placeholder="Ex: BEMVINDO10" required>
</div>
<div class="form-group">
<label for="coupon-description">Descri√ß√£o</label>
<input type="text" id="coupon-description" placeholder="Ex: 10% na primeira compra" required>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label for="coupon-type">Tipo de Desconto</label>
<select id="coupon-type" required>
<option value="percentage">Porcentagem (%)</option>
<option value="fixed">Valor Fixo (R$)</option>
<option value="free_delivery">Entrega Gr√°tis</option>
</select>
</div>
<div class="form-group">
<label for="coupon-value">Valor do Desconto</label>
<input type="number" id="coupon-value" placeholder="Ex: 10 ou 15.00" step="0.01" min="0" required>
</div>
</div>
<div class="form-group">
<label for="coupon-min-order-value">
Valor M√≠nimo do Pedido (Opcional)
</label>
<input type="number" id="coupon-min-order-value" placeholder="Ex: 100.00" step="0.01" min="0" class="form-control">
<small>Se preenchido, o cupom s√≥ ser√° v√°lido para pedidos com subtotal acima deste valor. Deixe em branco ou 0 se n√£o houver valor m√≠nimo.</small>
</div>
<div class="form-group">
<label class="closed-checkbox-label">
<input type="checkbox" id="coupon-one-time-use"> Limitar a um uso por cliente
</label>
</div>
<div class="form-group">
<label class="closed-checkbox-label">
<input type="checkbox" id="coupon-active" checked> Cupom Ativo
</label>
</div>
<div class="form-actions">
<button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Cupom</button>
<button type="button" id="cancel-edit-coupon-btn" class="btn btn-secondary hidden"><i class="fas fa-times"></i> Cancelar Edi√ß√£o</button>
</div>
</form>
<div id="coupons-admin-container" style="margin-top:var(--space-lg);">
<p>
Carregando cupons...
</p>
</div>
</div>
</div>
<div class="settings-group">
<h3><i class="fas fa-store-alt"></i> Dados da Loja</h3>
<div class="settings-content-wrapper">
<form id="store-info-form" class="admin-form" style="padding:var(--space-md);box-shadow:none;border:none;">
<div class="form-group">
<label for="store-min-order">Pedido M√≠nimo (R$):</label><input type="number" id="store-min-order" step="0.01" min="0" class="form-control">
</div>
<div class="form-actions" style="margin-top:var(--space-md);">
<button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Dados</button>
</div>
</form>
</div>
</div>
</section>

<div id="product-selection-modal" class="admin-modal">
<div class="modal-content" style="max-width: 800px; height: 90vh;">
<button class="close-modal-btn">&times;</button>
<h3 style="flex-shrink: 0;"><i class="fas fa-plus-circle"></i> Adicionar Produtos ao Pedido</h3>
<div class="modal-body" style="display: flex; flex-direction: column; gap: 16px; padding-top: 10px;">
<div class="product-selection-controls" style="flex-shrink: 0;">
<select id="product-category-filter" class="form-control"></select>
</div>
<div id="product-list-container" class="pdv-product-grid" style="overflow-y: auto; flex-grow: 1;">
<p>
Carregando produtos...
</p>
</div>
</div>
<div class="modal-footer" style="flex-shrink: 0;">
<button type="button" class="btn btn-secondary close-modal-btn">Fechar</button>
</div>
</div>
</div>

<div id="order-details-modal" class="admin-modal">
<div class="modal-content" style="max-width: 600px;">
<button class="close-modal-btn" data-modal-id="order-details-modal">&times;</button>
<h3 id="modal-order-title"><i class="fas fa-receipt"></i> Detalhes do Pedido</h3>
<div class="modal-body">
</div>
<div class="modal-footer">
<button class="btn btn-primary" onclick="alert('Fun√ß√£o de impress√£o n√£o implementada.');"><i class="fas fa-print"></i> Imprimir Pedido</button>
</div>
</div>
</div>

<div id="delivery-summary-modal" class="admin-modal">
<div class="modal-content" style="max-width: 700px;">
<button class="close-modal-btn">&times;</button>
<h3><i class="fas fa-map-marked-alt"></i> Resumo de Entregas (Pedidos "A Caminho")</h3>
<div id="delivery-summary-body" class="modal-body">
<p>
Calculando rota...
</p>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary close-modal-btn">Fechar</button>
</div>
</div>
</div>

<div id="add-category-modal" class="admin-modal">
<div class="modal-content" style="max-width: 500px;">
<button class="close-modal-btn" data-modal-id="add-category-modal">&times;</button>
<h3><i class="fas fa-folder-plus"></i> Adicionar Nova Categoria</h3>
<form id="add-category-form" class="admin-form-modal">
<div class="form-group">
<label for="new-category-key">Chave da Categoria (ex: 'pizzas-novas', sem espa√ßos, min√∫sculas):</label>
<input type="text" id="new-category-key" required pattern="[a-z0-9-]+">
<small>Use apenas letras min√∫sculas, n√∫meros e h√≠fens. Este ser√° o identificador interno.</small>
</div>
<div class="form-group">
<label for="new-category-name">Nome de Exibi√ß√£o da Categoria (ex: 'Pizzas Novas'):</label>
<input type="text" id="new-category-name" required>
</div>
<div class="form-actions">
<button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Categoria</button>
<button type="button" class="btn btn-secondary close-modal-btn" data-modal-id="add-category-modal"></button>
</div>
</form>
</div>
</div>

<div id="item-editor-modal" class="admin-modal">
<div class="modal-content" style="max-width: 600px;">
<button class="close-modal-btn" data-modal-id="item-editor-modal">&times;</button>
<h3 id="item-editor-title"><i class="fas fa-pizza-slice"></i> Adicionar/Editar Item</h3>
<form id="item-editor-form" class="admin-form-modal">
<input type="hidden" id="edit-item-id">
<input type="hidden" id="edit-item-category-key">
<div class="form-group">
<label for="item-name">Nome do Item:</label>
<input type="text" id="item-name" required>
</div>
<div class="form-group">
<label for="item-description">Descri√ß√£o:</label>
<textarea id="item-description" rows="3" placeholder="Ingredientes, detalhes..."></textarea>
</div>
<div class="form-row">
<div class="form-group">
<label for="item-price">Pre√ßo (R$):</label>
<input type="number" id="item-price" step="0.01" min="0" required>
</div>
<div class="form-group">
<label for="item-image">URL da Imagem (Ex: ../img/pizzas/mucarela.png):</label>
<input type="text" id="item-image" placeholder="Caminho relativo da imagem">
</div>
</div>
<div class="form-actions">
<button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Item</button>
</div>
</form>
</div>
</div>

<div id="pdv-pizza-customization-modal" class="admin-modal">
<div class="modal-content" style="max-width: 500px;">
<button class="close-modal-btn">&times;</button>
<div class="modal-scrollable-content">
<h3 id="pdv-modal-product-name"></h3>
<p id="pdv-modal-product-description"></p>
<div id="pdv-selected-halves-info" class="hidden" style="margin-bottom: 15px; background-color: #f9f9f9; padding: 10px; border-radius: 5px;">
<p style="margin: 0 0 5px 0;">
<strong>Meio:</strong> <span id="pdv-first-half-name-display"></span>
</p>
<p style="margin: 0;">
<strong>Meio:</strong> <span id="pdv-second-half-name-display"></span>
</p>
</div>
<div class="options-section">
<h4>Escolha o Tamanho:</h4>
<div class="option-group">
<label class="option-label">
<input type="radio" name="pdv-pizza-size" value="inteira" checked> Inteira
<span id="pdv-price-inteira" class="option-price"></span>
</label>
</div>
<div class="option-group">
<label class="option-label">
<input type="radio" name="pdv-pizza-size" value="metade"> Metade/Metade
<span id="pdv-price-metade" class="option-price"></span>
</label>
</div>
</div>
<div id="pdv-second-half-options" class="options-section hidden">
<h4>Escolha a 2¬™ Metade:</h4>
<div id="pdv-second-half-list" class="product-grid" style="max-height: 300px; overflow-y: auto;"></div>
</div>
<div id="pdv-stuffed-crust-options-container" class="options-section">
<h4>Borda Recheada (Opcional):</h4>
<div id="pdv-stuffed-crust-type-list"></div>
</div>
</div>
<div class="modal-fixed-bottom" style="padding: var(--space-md); border-top: 1px solid var(--admin-border-color);">
<button id="pdv-add-pizza-to-cart-btn" class="btn btn-success" style="width: 100%;">Adicionar ao Pedido</button>
</div>
</div>
</div>

<div id="pdv-new-customer-modal" class="admin-modal">
<div class="modal-content" style="max-width: 600px;">
<button class="close-modal-btn">&times;</button>
<h3><i class="fas fa-user-plus"></i> Cadastrar Novo Cliente</h3>
<form id="pdv-new-customer-form" class="admin-form-modal">
<div class="form-row">
<div class="form-group">
<label for="new-customer-firstname">Nome</label>
<input type="text" id="new-customer-firstname" class="form-control" required>
</div>
<div class="form-group">
<label for="new-customer-lastname">Sobrenome</label>
<input type="text" id="new-customer-lastname" class="form-control" required>
</div>
</div>
<div class="form-group">
<label for="new-customer-whatsapp">WhatsApp (somente n√∫meros com DDD)</label>
<input type="tel" id="new-customer-whatsapp" class="form-control" required>
</div>
<hr>
<h4>Endere√ßo de Entrega</h4>
<div class="form-row">
<div class="form-group">
<label for="new-customer-street">Rua / Avenida</label>
<input type="text" id="new-customer-street" class="form-control">
</div>
<div class="form-group" style="flex-basis: 120px; flex-grow: 0;">
<label for="new-customer-number">N√∫mero</label>
<input type="text" id="new-customer-number" class="form-control">
</div>
</div>
<div class="form-group">
<label for="new-customer-neighborhood">Bairro</label>
<select id="new-customer-neighborhood" class="form-control">
<option value="" disabled selected>Selecione o bairro...</option>
</select>
</div>
<div class="form-group">
<label for="new-customer-complement">Complemento</label>
<input type="text" id="new-customer-complement" class="form-control" placeholder="Apto, casa, etc.">
</div>
<div class="form-group">
<label for="new-customer-reference">Ponto de Refer√™ncia</label>
<input type="text" id="new-customer-reference" class="form-control">
</div>
<div class="form-actions">
<button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
<button type="submit" class="btn btn-success"><i class="fas fa-check"></i> Usar este Cliente</button>
</div>
</form>
</div>
</div>

<div id="edit-customer-modal" class="admin-modal">
<div class="modal-content">
<button class="close-modal-btn" data-modal-id="edit-customer-modal">&times;</button>
<h3><i class="fas fa-user-edit"></i> Editar Cliente</h3>
<form id="edit-customer-form" class="admin-form-modal">
</form>
</div>
</div>

<div id="pdv-discount-modal" class="admin-modal">
<div class="modal-content" style="max-width: 550px;">
<button class="close-modal-btn">&times;</button>
<h3><i class="fas fa-tags"></i> Aplicar Desconto no Pedido</h3>
<div class="modal-body">
<div id="pdv-discount-loyalty-section">
<h4>Usar Pontos de Fidelidade do Cliente</h4>
<div id="pdv-loyalty-info">
<p>
Cliente selecionado tem <strong id="pdv-customer-points-display">0</strong> ponto(s).
</p>
</div>
<div id="pdv-loyalty-options-container">
<p class="empty-list-message">
Nenhum resgate dispon√≠vel com os pontos atuais.
</p>
</div>
</div>
<div id="pdv-discount-coupons-section" style="margin-top: 20px;">
<h4>Usar Cupom de Desconto</h4>
<div id="pdv-coupons-list-container">
<p class="empty-list-message">
Nenhum cupom de desconto dispon√≠vel no momento.
</p>
</div>
</div>
</div>
<div class="modal-footer">
<button id="pdv-remove-discount-btn" type="button" class="btn btn-danger" style="display: none; margin-right: auto;">Remover Desconto</button>
<button id="pdv-confirm-discount-btn" type="button" class="btn btn-success">Aplicar Selecionado</button>
<button type="button" class="btn btn-secondary close-modal-btn">Fechar</button>
</div>
</div>
</div>

</section>
<section id="saques-view" class="admin-view">
<div class="view-header">
<h2><i class="fas fa-hand-holding-usd"></i> Solicita√ß√µes de Saque</h2>
</div>
<p class="form-instruction">
Abaixo est√£o as solicita√ß√µes de saque feitas pelos entregadores. Ao clicar em "Marcar como Pago", o Sistema registrar√° uma retirada no caixa do entregador no valor total solicitado, zerando seu saldo.
</p>

<div id="saques-list-container" class="saques-list-grid">
<p class="empty-list-message">
Carregando solicita√ß√µes...
</p>
</div>

<hr style="margin: 40px 0;">

<div class="view-header">
<h3><i class="fas fa-history"></i> Hist√≥rico de Saques Aprovados</h3>
</div>

<div id="saques-history-container" class="saques-list-grid">
<p class="empty-list-message">
Carregando hist√≥rico...
</p>
</div>
</section>
</main>
</div>

<div id="notification-dropdown" class="chat-dropdown-container hidden">
<div class="chat-dropdown-header">
Central de Notifica√ß√µes
</div>
<div id="notification-dropdown-list" class="chat-dropdown-body">
<p class="empty-message">
Nenhuma nova notifica√ß√£o.
</p>
</div>
</div>

<script type="module">
  // 1. Importa todos os m√≥dulos necess√°rios do Firebase
  import {
    initializeApp
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getFirestore,
    doc,
    getDoc,
    getDocs,
    setDoc,
    updateDoc,
    collection,
    query,
    where,
    orderBy,
    onSnapshot,
    deleteDoc,
    writeBatch,
    serverTimestamp,
    Timestamp,
    limit,
    arrayUnion,
    arrayRemove,
    increment,
    documentId,
    addDoc
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import {
    getAuth,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import {
    getMessaging,
    getToken,
    onMessage
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging.js";
  // Import para as Fun√ß√µes Cham√°veis (Callable Functions)
  import {
    getFunctions,
    httpsCallable
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";

  // 2. Sua configura√ß√£o do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDMaD6Z3CDxdkyzQXHpV3b0QBWr--xQTso",
    authDomain: "app-ditalia.firebaseapp.com",
    projectId: "app-ditalia",
    storageBucket: "app-ditalia.firebasestorage.app",
    messagingSenderId: "122567535166",
    appId: "1:122567535166:web:19de7b8925042027063f6f",
    measurementId: "G-5QW3MVGYME"
  };

  // 3. Inicializa os servi√ßos e os define globalmente para evitar erros de carregamento
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const messaging = getMessaging(app);
  const functions = getFunctions(app, 'us-central1'); // Define a regi√£o da sua fun√ß√£o

  window.firebaseApp = app;
  window.db = db;
  window.auth = auth;

  window.firebaseFirestore = {
    doc,
    getDoc,
    getDocs,
    setDoc,
    updateDoc,
    collection,
    query,
    where,
    orderBy,
    onSnapshot,
    deleteDoc,
    writeBatch,
    serverTimestamp,
    Timestamp,
    limit,
    arrayUnion,
    arrayRemove,
    increment,
    documentId,
    addDoc
  };

  window.firebaseMessaging = {
    getMessaging,
    getToken,
    onMessage,
    messagingInstance: messaging
  };

  window.firebaseFunctions = {
    httpsCallable,
    functions
  };

  // 4. Monitora o estado de autentica√ß√£o para iniciar o painel ou redirecionar
  onAuthStateChanged(auth, (user) => {
    if (user) {
      // Usu√°rio est√° logado, inicia a l√≥gica do painel
      if (typeof startAdminPanel === 'function') {
        startAdminPanel();
      }
      if (typeof setupAdminNotifications === 'function') {
        setupAdminNotifications();
      }
      
      const logoutButton = document.getElementById('logout-button');
      if (logoutButton) {
        logoutButton.addEventListener('click', () => {
          signOut(auth).then(() => {
            window.location.href = 'login.html';
          }).catch((error) => {
            console.error("Erro ao fazer logout: ", error);
          });
        });
      }

    } else {
      // Usu√°rio n√£o est√° logado, redireciona para a tela de login
      window.location.href = 'login.html';
    }
  });
</script>
<script src="appearance.js" defer></script>
<script src="config.js" defer></script>
<script src="admin.js" defer></script>
<script src="cardapio.js" defer></script>
<script src="promocoes.js" defer></script>
<script src="pedidos.js" defer></script>
<script src="clientes.js" defer></script>
<script src="vendas.js" defer></script>
<script src="pdv.js" defer></script>
<script src="comunicados.js" defer></script>
<script src="importar.js" defer></script>
<script src="saques.js" defer></script>
<script src="mapa.js" defer></script>
<script src="financeiro.js" defer></script>

</body>
</html>
